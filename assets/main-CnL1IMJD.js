var E=Object.defineProperty;var _=(s,e,t)=>e in s?E(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var l=(s,e,t)=>_(s,typeof e!="symbol"?e+"":e,t);import{i as v,S as m,s as g,a as x,b,c as I,d as C,e as R,f as D,g as N,h as B,j as T,t as O,k as U,l as L}from"./session-storage-Bvod-aZa.js";const p=(s,e,t)=>({time:s,userStoryName:e.name,thread:t,state:e.state});class S{constructor(e,t){l(this,"_devs",[]);l(this,"_review");this._devs=e,this._review=t}run(e){const t=[];let n=1;for(;e.hasMoreUserStories();){const r=[];for(const i of this._devs){const o=e.next(i);if(o==v){v.thread=i.id,t.push(p(n,v,i.id));continue}if(o.state==m.TO_REVIEW||o.state==m.REVIEW){const a=g(o,i);if(t.push(p(n,a,i.id)),x(a)){const c=b(o,a.thread);t.push(p(n,c,c.thread)),r.push(c)}else e.add(a)}if(o.state==m.TODO||o.state==m.IN_PROGRESS){const a=I(o,i);if(t.push(p(n,a,i.id)),C(a))if(this._review){const c=R(a,i);t.push(p(n,c,i.id)),r.push(c)}else{const c=D(a);t.push(p(n,c,i.id)),r.push(c)}else r.push(a)}}r.forEach(i=>e.add(i)),n++}return t}}l(S,"parallelTeam",()=>new A);class A{constructor(){l(this,"_devs",[]);l(this,"_review",!1)}withDev(e){return this._devs.push(e),this}withDevCount(e){for(let t=0;t<e;t++)this._devs.push({id:t,power:1});return this}withReview(e=!0){return this._review=e,this}build(){return new S(this._devs,this._review)}}class M{constructor(){l(this,"userStories",[]);l(this,"addUserStory",e=>(this.userStories.push(e),this))}build(){return new y(this.userStories)}}class y{constructor(e){l(this,"_userStories");l(this,"_dones",[]);this._userStories=e}next(e){let t=this._userStories.findIndex(n=>N(n,e));if(t==-1&&(t=this._userStories.findIndex(n=>B(n,e))),t==-1){let n=Number.MAX_VALUE;this._userStories.forEach((r,i)=>{if(T(r,e)){const o=Math.abs(r.reviewComplexity-e.power);o<n&&(n=o,t=i)}})}if(t==-1){let n=Number.MAX_VALUE;this._userStories.forEach((r,i)=>{if(O(r)){const o=Math.abs(r.complexity-e.power);o<n&&(n=o,t=i)}})}return t!=-1?this._userStories.splice(t,1)[0]:v}add(e){e.state==m.DONE?this._dones.push(e):this._userStories.push(e)}dones(){return this._dones}remainings(){return this._userStories}hasMoreUserStories(){return this._userStories.length>0}}l(y,"init",()=>new M);const P=s=>s.reduce((t,n)=>t+n,0)/s.length,$=s=>{const e=new Map,t=[],n=[];let r=1;for(;;){const i=s.filter(u=>u.time==r);if(i.length===0)break;const o=new Set(i.filter(u=>u.state===m.IN_PROGRESS).map(u=>u.userStoryName));for(const u of o)e.has(u)||e.set(u,0);e.forEach((u,h)=>{e.set(h,u+1)});const a=new Set(i.filter(u=>u.state===m.DONE).map(u=>u.userStoryName));for(const u of a){const h=e.get(u);h&&t.push(h),e.delete(u)}const c=P(t);n.push({time:r,leadTime:c}),r++}return n},k=s=>{const e=document.createElement("span");e.id=`dev-identifier-${s}`,e.textContent=s.toString();const t=w("Power"),n=f(`power-input-${s}`,1),r=document.createElement("div");return r.append(e,t,n),r},f=(s,e)=>{const t=document.createElement("input");return t.id=s,t.type="number",t.min="1",t.value=e.toString(),t},w=s=>{const e=document.createElement("label");return e.textContent=s,e},q=s=>{const e=document.createElement("span");e.id=`user-story-identifier-${s}`,e.textContent=s.toString();const t=w("Complexity"),n=f(`complexity-input-${s}`,5),r=w("Review complexity"),i=f(`review-complexity-input-${s}`,2),o=document.createElement("div");return o.append(e,t,n,r,i),o},d=s=>{var e;return parseInt(((e=document.querySelector(s))==null?void 0:e.value)??"0")},V=()=>{const s=d("#user-story-count-input"),e=d("#reviewers-input"),t=y.init();return Array.from({length:s},(n,r)=>t.addUserStory({name:`US${r}`,complexity:d(`#complexity-input-${r}`),review:{reviewersNeeded:e,reviewers:new Map},reviewComplexity:d(`#review-complexity-input-${r}`),state:m.TODO,thread:void 0,progression:0})),t.build()},F=()=>{const s=S.parallelTeam(),e=d("#dev-count-input");Array.from({length:e},(r,i)=>({id:i,power:d(`#power-input-${i}`)})).forEach(r=>s.withDev(r));const n=d("#reviewers-input")>0;return s.withReview(n),s.build()};document.addEventListener("DOMContentLoaded",()=>{var s,e,t;(s=document.querySelector("#calculate-button"))==null||s.addEventListener("click",()=>{const n=V(),i=F().run(n);U(i);const o=$(i);L(o),window.location.href="/TeamSpirit/flow/flow.html"}),(e=document.querySelector("#generate-devs-button"))==null||e.addEventListener("click",()=>{const n=document.getElementById("devs-container"),r=d("#dev-count-input"),i=Array.from({length:r},(o,a)=>k(a));n==null||n.replaceChildren(...i)}),(t=document.querySelector("#generate-user-stories-button"))==null||t.addEventListener("click",()=>{const n=document.getElementById("user-stories-container"),r=d("#user-story-count-input"),i=Array.from({length:r},(o,a)=>q(a));n==null||n.replaceChildren(...i)})});
