import{l as U,c as E,d as k}from"./session-storage-Om7Yksbp.js";const b=()=>document.querySelector("#lead-time"),x=()=>document.querySelector("#time"),S=(t,o,e)=>{const r=t.filter(n=>n.time===o);if(r.length===0)return;const a=b();a&&(a.textContent=r[0].leadTime?.toFixed(2)??Number.NaN);const s=x();s&&(s.textContent=`${r[0].time.toString()}/${e}`)},v=(t,o)=>{const e=document.createElement("span");e.textContent=o,e.className="name";const r=document.createElement("div");return r.id=`user-story-${t}`,r.className="userStory",r.appendChild(e),r},C=(t,o)=>{o.filter(e=>e.action==="CreateUserStory").filter(({id:e})=>e!==-1).map(({id:e,name:r})=>v(e,r)).forEach(e=>{t.appendChild(e)}),o.filter(e=>e.action==="ChangePriority").forEach(({id:e,value:r})=>{const a=u(e);if(a){const s=document.createElement("span");s.textContent=`(${r})`,s.className="priority",a.appendChild(s)}})},A=()=>document.querySelector("#threads"),$=t=>document.querySelector(`#thread${t}`),P=t=>document.querySelector(`#thread-state-${t}`),c=t=>document.querySelector(`#thread-user-story-${t}`),h=()=>document.querySelector("#backlog"),R=()=>document.querySelector("#done"),u=t=>document.querySelector(`[id^="user-story-${t}"]`),w=t=>Array.from(document.querySelectorAll(`[id^="user-story-${t}-"]`)),N=(t,o)=>document.querySelector(`#user-story-${t}-${o}`),D=()=>document.querySelector("#compute"),L=()=>document.querySelector("#compute-all"),O=(t,o)=>{const e=document.createElement("div");e.id=`thread${t}`,e.className="thread";const r=document.createElement("div");r.id=`thread-title-${t}`,r.textContent=o;const a=document.createElement("div");a.id=`thread-user-story-${t}`;const s=document.createElement("div");return s.id=`thread-state-${t}`,s.textContent="Wait",e.append(r,a,s),e},B=(t,o)=>{o.filter(e=>e.action==="CreateThread").forEach(({id:e,name:r})=>{const a=O(e,r);t.append(a)})},f=(t,o)=>{t.filter(({action:e,time:r})=>e==="ThreadOff"&&r===o).forEach(({id:e})=>{const r=$(e);r&&(r.style.opacity="50%")})},p=(t,o)=>{t.filter(({action:e,time:r})=>e==="ThreadIn"&&r===o).forEach(({id:e})=>{const r=$(e);r&&(r.style.opacity="100%")})},m=(t,o)=>{const e=P(t);e&&(e.textContent=o)},T=t=>{Array.from(c(t.threadId)?.children??[]).forEach(o=>{o.remove()})},H=t=>new Promise(o=>setTimeout(o,t)),F=t=>{const o=`user-story-${t.userStoryId}-${t.threadId}`;Array.from(c(t.threadId)?.children??[]).filter(r=>r.id!==o).forEach(r=>{r.remove()});const e=u(t.userStoryId);e&&(c(t.threadId)?.appendChild(e),e.id=o)},W=t=>{const o=u(t.userStoryId)?.cloneNode(!0);o&&(o.id=`user-story-${t.userStoryId}-${t.threadId}`,c(t.threadId)?.appendChild(o)),document.querySelector(`#backlog #user-story-${t.userStoryId}`)?.remove()},M=t=>{const o=w(t.userStoryId),e=o.shift();e&&(h()?.appendChild(e),e.id=`user-story-${t.userStoryId}`),o.forEach(r=>{r.remove()})},j=t=>{const o=w(t.userStoryId),e=o.shift();e&&(R()?.appendChild(e),e.id=`user-story-${t.userStoryId}`),o.forEach(r=>{r.remove()})},I=async(t,o,e)=>{const r=t.filter(a=>a.time===o);for(const a of r){if(a.userStoryId===-1){T(a),m(a.threadId,"Wait");continue}switch(a.state){case"InProgress":{F(a),m(a.threadId,"Develop");break}case"Review":{if(N(a.userStoryId,a.threadId))continue;T(a),W(a),m(a.threadId,"Review");break}case"ToReview":{M(a);break}case"Done":{j(a);break}}await H(e)}},g=(t,o)=>{const e=h();if(e){const r=t.filter(({time:a})=>a===o);C(e,r)}},z=(t,o,e)=>{const r=A();r&&B(r,e);const a=h();if(a){const l=e.filter(({time:q})=>q===1);C(a,l)}const s=Math.max(...t.map(l=>l.time));let n=0;const i=D();i?.addEventListener("click",async()=>{i.disabled=!0,n++,await I(t,n,600),S(o,n,s),g(e,n+1),f(e,n+1),p(e,n+1),s!==n&&(i.disabled=!1)});const y=L();y?.addEventListener("click",async()=>{for(;s!==n;)n++,await I(t,n,300),S(o,n,s),g(e,n+1),f(e,n+1),p(e,n+1);y.disabled=!0})},G=new URLSearchParams(window.location.search),d=G.get("id");d&&z(k(d),E(d),U(d));
