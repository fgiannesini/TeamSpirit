var x=Object.defineProperty;var T=(t,e,n)=>e in t?x(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var p=(t,e,n)=>T(t,typeof e!="symbol"?e+"":e,n);import{i as I,a as b,b as C,t as N,c as v,S as l,h as D,s as $,d as O,e as y,f as S,g as U,j as B,k as A,n as L,l as _,m as q}from"./session-storage-Pv8ZUQa-.js";class P{constructor(e){p(this,"threads",[]);this.threads=e}getThreads(){return this.threads}}class M{constructor(e){p(this,"threads");this.threads=e}getThreads(){const e=this.threads.map(s=>s.power).reduce((s,o)=>s+o,0);return[{id:1,power:Math.round(e/this.threads.length)}]}}class R{constructor(e){p(this,"userStoriesRemaining");p(this,"userStoriesDone",[]);this.userStoriesRemaining=e}}const V=(t,e)=>{let n=t.userStoriesRemaining.findIndex(s=>I(s,e));if(n==-1&&(n=t.userStoriesRemaining.findIndex(s=>b(s,e))),n==-1){let s=Number.MAX_VALUE;t.userStoriesRemaining.forEach((o,r)=>{if(C(o,e)){const i=Math.abs(o.reviewComplexity-e.power);i<s&&(s=i,n=r)}})}if(n==-1){let s=Number.MAX_VALUE;t.userStoriesRemaining.forEach((o,r)=>{if(N(o)){const i=Math.abs(o.complexity-e.power);i<s&&(s=i,n=r)}})}return n!=-1?t.userStoriesRemaining.splice(n,1)[0]:v},k=t=>t.userStoriesRemaining.filter(e=>e.state===l.REVIEW).filter(e=>D(e.review,e.reviewComplexity)),g=(t,e)=>{t.state==l.DONE?e.userStoriesDone.push(t):e.userStoriesRemaining.push(t)},F=t=>t.userStoriesRemaining.length>0,W=t=>t.reduce((n,s)=>n+s,0)/t.length,K=t=>{const e=new Map,n=[],s=[];let o=1;for(;;){const r=t.filter(c=>c.time==o);if(r.length===0)break;const i=new Set(r.filter(c=>c.state===l.IN_PROGRESS).map(c=>c.userStoryName));for(const c of i)e.has(c)||e.set(c,0);e.forEach((c,h)=>{e.set(h,c+1)});const a=new Set(r.filter(c=>c.state===l.DONE).map(c=>c.userStoryName));for(const c of a){const h=e.get(c);h&&n.push(h),e.delete(c)}const m=W(n);s.push({time:o,leadTime:m}),o++}return s},G=t=>{const e=document.createElement("span");e.id=`dev-identifier-${t}`,e.textContent=t.toString();const n=f("Power"),s=w(`power-input-${t}`,1),o=document.createElement("div");return o.append(e,n,s),o},w=(t,e)=>{const n=document.createElement("input");return n.id=t,n.type="number",n.min="1",n.value=e.toString(),n},f=t=>{const e=document.createElement("label");return e.textContent=t,e},X=t=>{const e=document.createElement("span");e.id=`user-story-identifier-${t}`,e.textContent=t.toString();const n=f("Complexity"),s=w(`complexity-input-${t}`,5),o=f("Review complexity"),r=w(`review-complexity-input-${t}`,2),i=document.createElement("div");return i.append(e,n,s,o,r),i},d=(t,e,n)=>({time:t,userStoryName:e.name,thread:n,state:e.state}),j=(t,e,n)=>{const s=[],o=[];for(const r of t.getThreads()){const i=V(e,r);if(i==v){v.thread=r.id,s.push(d(n,v,r.id));continue}switch(i.state){case l.TO_REVIEW:case l.REVIEW:{const a=B(i,r);if(s.push(d(n,a,r.id)),y(a)){const m=A(i,a.thread);s.push(d(n,m,m.thread)),o.push(m)}else g(a,e);break}case l.TODO:case l.IN_PROGRESS:{const a=$(i,r);if(s.push(d(n,a,r.id)),O(a))if(y(a)){const m=U(a);s.push(d(n,m,r.id)),o.push(m)}else{const m=S(a,r.id);s.push(d(n,m,r.id)),o.push(m)}else o.push(a);break}}}return k(e).forEach(r=>{const i=S(r,r.thread);s.push(d(n,i,r.thread))}),o.forEach(r=>g(r,e)),s},z=(t,e)=>{const n=[];let s=1;for(;F(t);)n.push(...j(e,t,s)),s++;return n},u=t=>{var n;const e=parseInt(((n=document.querySelector(t))==null?void 0:n.value)??"0");return isNaN(e)?0:e},H=()=>{const t=u("#user-story-count-input"),e=u("#reviewers-input");return new R(Array.from({length:t},(n,s)=>({name:`US${s}`,complexity:u(`#complexity-input-${s}`),review:{reviewersNeeded:e,reviewers:new Map},reviewComplexity:u(`#review-complexity-input-${s}`),state:l.TODO,thread:void 0,progression:0})))},J=()=>{const t=u("#user-story-count-input");return new R(Array.from({length:t},(e,n)=>({name:`US${n}`,complexity:u(`#complexity-input-${n}`),review:L,reviewComplexity:u(`#review-complexity-input-${n}`),state:l.TODO,thread:void 0,progression:0})))},Q=()=>{const t=u("#dev-count-input"),e=Array.from({length:t},(n,s)=>({id:s,power:u(`#power-input-${s}`)}));return new P(e)},Y=()=>{const t=u("#dev-count-input"),e=Array.from({length:t},(n,s)=>({id:s,power:u(`#power-input-${s}`)}));return new M(e)},E=(t,e)=>{const n=z(t,e),s=crypto.randomUUID();_(n,s);const o=K(n);return q(o,s),s};document.addEventListener("DOMContentLoaded",()=>{var t,e,n;(t=document.querySelector("#calculate-button"))==null||t.addEventListener("click",()=>{const s=J(),o=E(s,Y());window.open(`/TeamSpirit/flow/flow.html?id=${o}`),window.open(`/TeamSpirit/time-sequence/time-sequence.html?id=${o}`);const r=H(),i=E(r,Q());window.open(`/TeamSpirit/flow/flow.html?id=${i}`),window.open(`/TeamSpirit/time-sequence/time-sequence.html?id=${i}`)}),(e=document.querySelector("#generate-devs-button"))==null||e.addEventListener("click",()=>{const s=document.getElementById("devs-container"),o=u("#dev-count-input"),r=Array.from({length:o},(i,a)=>G(a));s==null||s.replaceChildren(...r)}),(n=document.querySelector("#generate-user-stories-button"))==null||n.addEventListener("click",()=>{const s=document.getElementById("user-stories-container"),o=u("#user-story-count-input"),r=Array.from({length:o},(i,a)=>X(a));s==null||s.replaceChildren(...r)})});
