import{l as U,c as k,d as E}from"./session-storage-Om7Yksbp.js";const b=()=>document.querySelector("#lead-time"),x=()=>document.querySelector("#time"),y=(t,r,e)=>{const o=t.filter(a=>a.time===r);if(o.length===0)return;const s=b();s&&(s.textContent=o[0].leadTime?.toFixed(2)??Number.NaN);const d=x();d&&(d.textContent=`${o[0].time.toString()}/${e}`)},v=(t,r)=>{const e=document.createElement("div");return e.id=`user-story-${t}`,e.className="userStory",e.textContent=r,e},g=(t,r)=>{r.filter(({action:e})=>e==="CreateUserStory").filter(({id:e})=>e!==-1).map(({id:e,name:o})=>v(e,o)).forEach(e=>{t.appendChild(e)})},A=()=>document.querySelector("#threads"),$=t=>document.querySelector(`#thread${t}`),R=t=>document.querySelector(`#thread-state-${t}`),c=t=>document.querySelector(`#thread-user-story-${t}`),h=()=>document.querySelector("#backlog"),P=()=>document.querySelector("#done"),C=t=>document.querySelector(`[id^="user-story-${t}"]`),w=t=>Array.from(document.querySelectorAll(`[id^="user-story-${t}-"]`)),D=(t,r)=>document.querySelector(`#user-story-${t}-${r}`),L=()=>document.querySelector("#compute"),O=()=>document.querySelector("#compute-all"),B=(t,r)=>{const e=document.createElement("div");e.id=`thread${t}`,e.className="thread";const o=document.createElement("div");o.id=`thread-title-${t}`,o.textContent=r;const s=document.createElement("div");s.id=`thread-user-story-${t}`;const d=document.createElement("div");return d.id=`thread-state-${t}`,d.textContent="Wait",e.append(o,s,d),e},H=(t,r)=>{r.filter(e=>e.action==="CreateThread").forEach(e=>{const o=B(e.id,e.name);t.append(o)})},S=(t,r)=>{t.filter(({action:e,time:o})=>e==="ThreadOff"&&o===r).forEach(({id:e})=>{const o=$(e);o&&(o.style.opacity="50%")})},f=(t,r)=>{t.filter(({action:e,time:o})=>e==="ThreadIn"&&o===r).forEach(({id:e})=>{const o=$(e);o&&(o.style.opacity="100%")})},m=(t,r)=>{const e=R(t);e&&(e.textContent=r)},p=t=>{Array.from(c(t.threadId)?.children??[]).forEach(r=>{r.remove()})},N=t=>new Promise(r=>setTimeout(r,t)),F=t=>{const r=`user-story-${t.userStoryId}-${t.threadId}`;Array.from(c(t.threadId)?.children??[]).filter(o=>o.id!==r).forEach(o=>{o.remove()});const e=C(t.userStoryId);e&&(c(t.threadId)?.appendChild(e),e.id=r)},W=t=>{const r=C(t.userStoryId)?.cloneNode(!0);r&&(r.id=`user-story-${t.userStoryId}-${t.threadId}`,c(t.threadId)?.appendChild(r)),document.querySelector(`#backlog #user-story-${t.userStoryId}`)?.remove()},M=t=>{const r=w(t.userStoryId),e=r.shift();e&&(h()?.appendChild(e),e.id=`user-story-${t.userStoryId}`),r.forEach(o=>{o.remove()})},j=t=>{const r=w(t.userStoryId),e=r.shift();e&&(P()?.appendChild(e),e.id=`user-story-${t.userStoryId}`),r.forEach(o=>{o.remove()})},T=async(t,r,e)=>{const o=t.filter(s=>s.time===r);for(const s of o){if(s.userStoryId===-1){p(s),m(s.threadId,"Wait");continue}switch(s.state){case"InProgress":{F(s),m(s.threadId,"Develop");break}case"Review":{if(D(s.userStoryId,s.threadId))continue;p(s),W(s),m(s.threadId,"Review");break}case"ToReview":{M(s);break}case"Done":{j(s);break}}await N(e)}},I=(t,r)=>{const e=h();if(e){const o=t.filter(({time:s})=>s===r);g(e,o)}},z=(t,r,e)=>{const o=A();o&&H(o,e);const s=h();if(s){const l=e.filter(({time:q})=>q===1);g(s,l)}const d=Math.max(...t.map(l=>l.time));let a=0;const i=L();i?.addEventListener("click",async()=>{i.disabled=!0,a++,await T(t,a,1e3),y(r,a,d),I(e,a+1),S(e,a+1),f(e,a+1),d!==a&&(i.disabled=!1)});const u=O();u?.addEventListener("click",async()=>{for(;d!==a;)a++,await T(t,a,300),y(r,a,d),I(e,a+1),S(e,a+1),f(e,a+1);u.disabled=!0})},G=new URLSearchParams(window.location.search),n=G.get("id");n&&z(E(n),k(n),U(n));
