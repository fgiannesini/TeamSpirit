import{S as m,o as v,p as w}from"./session-storage-Pv8ZUQa-.js";const C=e=>{const t=document.createElement("div");return t.id=e,t.className="userStory",t.textContent=e,t},$=(e,t)=>{Array.from(new Set(t.map(r=>r.userStoryName))).filter(r=>r!=="idle").map(r=>C(r)).forEach(r=>{e.appendChild(r)})},q=()=>document.querySelector("#threads"),U=e=>document.querySelector(`#thread-state-${e}`),S=e=>document.querySelector(`#thread-user-story-${e}`),N=()=>document.querySelector("#backlog"),k=()=>document.querySelector("#done"),u=e=>document.querySelector(`#${e}`),h=e=>u(e)??C(e),E=e=>Array.from(document.querySelectorAll(`[id^="${e}_"]`)),x=()=>document.querySelector("#compute"),R=()=>document.querySelector("#compute-all"),b=(e,t)=>e.filter(o=>o.state==m.REVIEW&&o.userStoryName===t).length>1,y=(e,t)=>{const o=U(e);o&&(o.textContent=t)},p=(...e)=>{e.filter(t=>t!==null).forEach(t=>t.remove())},g=async(e,t,o)=>{var n,s,c,d,l;const r=e.filter(a=>a.time==t);for(const a of r){if(a.userStoryName==="idle"){y(a.thread,"Wait");continue}switch(a.state){case m.IN_PROGRESS:{const i=u(a.userStoryName);i&&((n=S(a.thread))==null||n.appendChild(i),y(a.thread,"Develop"));break}case m.REVIEW:{if(b(r,a.userStoryName)){p(u(a.userStoryName));const i=`${a.userStoryName}_${a.thread}`;(s=S(a.thread))==null||s.appendChild(h(i))}else p(...E(a.userStoryName)),(c=S(a.thread))==null||c.appendChild(h(a.userStoryName));y(a.thread,"Review");break}case m.TO_REVIEW:{const i=u(a.userStoryName);i&&((d=N())==null||d.appendChild(i));break}case m.DONE:{p(...E(a.userStoryName));const i=h(a.userStoryName);(l=k())==null||l.appendChild(i);break}}await I(o)}},I=e=>new Promise(t=>setTimeout(t,e)),W=e=>{const t=document.createElement("div");t.id=`thread${e}`,t.className="thread";const o=document.createElement("div");o.id=`thread-title-${e}`,o.textContent=`Thread ${e}`;const r=document.createElement("div");r.id=`thread-user-story-${e}`;const n=document.createElement("div");return n.id=`thread-state-${e}`,n.textContent="Wait",t.append(o,r,n),t},A=(e,t)=>{Array.from(new Set(t.map(o=>o.thread))).forEach(o=>{const r=W(o);e.append(r)})},D=()=>document.querySelector("#lead-time"),L=()=>document.querySelector("#time"),T=(e,t,o)=>{var c;const r=e.filter(d=>d.time==t);if(r.length==0)return;const n=D();n&&(n.textContent=((c=r[0].leadTime)==null?void 0:c.toFixed(2))??NaN);const s=L();s&&(s.textContent=`${r[0].time.toString()}/${o}`)},O=(e,t)=>{const o=q();o&&A(o,e);const r=N();r&&$(r,e);const n=Math.max(...e.map(l=>l.time));let s=0;const c=x();c==null||c.addEventListener("click",async()=>{c.disabled=!0,s++,await g(e,s,1e3),T(t,s,n),n!==s&&(c.disabled=!1)});const d=R();d==null||d.addEventListener("click",async()=>{for(;n!==s;)s++,await g(e,s,300),T(t,s,n);d.disabled=!0})},P=new URLSearchParams(window.location.search),f=P.get("id");f&&O(w(f),v(f));
