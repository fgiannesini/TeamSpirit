var x=Object.defineProperty;var T=(e,t,n)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var l=(e,t,n)=>T(e,typeof t!="symbol"?t+"":t,n);import{s as C,a as b,b as $}from"./session-storage-Om7Yksbp.js";const D=e=>{const t=document.createElement("span");t.id=`dev-identifier-${e}`,t.textContent=e.toString();const n=h("Power"),s=w(`power-input-${e}`,1),r=document.createElement("div");return r.append(t,n,s),r},w=(e,t)=>{const n=document.createElement("input");return n.id=e,n.type="number",n.min="1",n.value=t.toString(),n},h=e=>{const t=document.createElement("label");return t.textContent=e,t},U=e=>{const t=document.createElement("span");t.id=`user-story-identifier-${e}`,t.textContent=e.toString();const n=h("Complexity"),s=w(`complexity-input-${e}`,5),r=h("Review complexity"),o=w(`review-complexity-input-${e}`,2),i=document.createElement("div");return i.append(t,n,s,r,o),i},g={reviewersNeeded:0,reviewers:new Map},P=(e,t)=>e.reviewers.get(t.id)??0,B=(e,t)=>{const{reviewers:n,reviewersNeeded:s}=e;return n.size!==s&&!n.has(t.id)},M=(e,t,n)=>{const s=e.reviewers,r=s.get(t.id);return s.has(t.id)&&r!==n},N=(e,t)=>e.reviewersNeeded===e.reviewers.size&&e.reviewers.values().every(n=>n===t),A=(e,t)=>e.reviewersNeeded!==e.reviewers.size&&e.reviewers.values().every(n=>n===t),v={id:-1,name:"idle",complexity:0,progression:0,reviewComplexity:0,review:g,threadId:void 0,state:"Done"},L=(e,t)=>({...e,progression:Math.min(e.progression+t.power,e.complexity),threadId:t.id,state:"InProgress"}),q=(e,t)=>({...e,state:"Done",threadId:t}),_=e=>({...e,state:"Done"}),R=(e,t)=>({...e,state:"ToReview",threadId:t}),z=(e,t,n)=>{const s=new Map(e.reviewers).set(t.id,n);return{...e,reviewers:s}},F=(e,t)=>{const n=e.review,s=P(n,t),r=Math.min(s+t.power,e.reviewComplexity),o=z(n,t,r);return{...e,state:"Review",review:o}},O=e=>e.progression===e.complexity,I=e=>N(e.review,e.reviewComplexity),K=(e,t)=>e.state==="InProgress"&&e.threadId===t.id,V=(e,t)=>e.state!=="Review"||e.threadId===t.id?!1:M(e.review,t,e.reviewComplexity),X=(e,t)=>e.state==="Review"&&e.threadId!==t.id&&B(e.review,t),G=(e,t)=>e.state==="ToReview"&&e.threadId!==t.id,W=e=>e.state==="Todo";class E{constructor(t){l(this,"userStoriesRemaining");l(this,"userStoriesDone",[]);this.userStoriesRemaining=t}}const y=e=>[...e.userStoriesRemaining,...e.userStoriesDone],j=(e,t)=>{let n=e.userStoriesRemaining.findIndex(s=>K(s,t));if(n===-1&&(n=e.userStoriesRemaining.findIndex(s=>V(s,t))),n===-1&&(n=e.userStoriesRemaining.findIndex(s=>X(s,t))),n===-1){let s=Number.MAX_VALUE;e.userStoriesRemaining.forEach((r,o)=>{if(G(r,t)){const i=Math.abs(r.reviewComplexity-t.power);i<s&&(s=i,n=o)}})}if(n===-1){let s=Number.MAX_VALUE;e.userStoriesRemaining.forEach((r,o)=>{if(W(r)){const i=Math.abs(r.complexity-t.power);i<s&&(s=i,n=o)}})}return n!==-1?e.userStoriesRemaining.splice(n,1)[0]:v},H=e=>e.userStoriesRemaining.filter(t=>t.state==="Review").filter(t=>A(t.review,t.reviewComplexity)),f=(e,t)=>{e.state==="Done"?t.userStoriesDone.push(e):t.userStoriesRemaining.push(e)},J=e=>e.userStoriesRemaining.length>0,Q=e=>{const t=e.shift();return t!==void 0&&t<.1},Y=(e,t)=>{const n=y(e).map(r=>({time:1,id:r.id,name:r.name,action:"CreateUserStory"}));return[...t.getThreads().map(r=>({time:1,id:r.id,name:r.name,action:"CreateThread"})),...n]},m=(e,t,n)=>({time:e,userStoryId:t.id,threadId:n,state:t.state}),Z=(e,t,n)=>{const s=[],r=[];for(const o of e.getThreads()){const i=j(t,o);if(i===v){v.threadId=o.id,s.push(m(n,v,o.id));continue}switch(i.state){case"ToReview":case"Review":{const c=F(i,o);if(s.push(m(n,c,o.id)),I(c)){const u=q(i,c.threadId);s.push(m(n,u,u.threadId)),r.push(u)}else f(c,t);break}case"Todo":case"InProgress":{const c=L(i,o);if(s.push(m(n,c,o.id)),O(c))if(I(c)){const u=_(c);s.push(m(n,u,o.id)),r.push(u)}else{const u=R(c,o.id);s.push(m(n,u,o.id)),r.push(u)}else r.push(c);break}}}return H(t).forEach(o=>{const i=R(o,o.threadId);s.push(m(n,i,o.threadId))}),r.forEach(o=>f(o,t)),s},k=(e,t,n)=>{const s=[];let r=1,o=0;const i=Y(e,t);for(;J(e);){if(Q(n)){const c=y(e).length,u=`bug-${o}`;i.push({time:r,name:u,id:c,action:"CreateUserStory"}),f({id:c,name:u,complexity:1,reviewComplexity:1,progression:0,review:g,threadId:void 0,state:"Todo"},e),o++}s.push(...Z(t,e,r)),r++}return{timeEvents:s,structureEvents:i}},ee=e=>e.reduce((n,s)=>n+s,0)/e.length,te=e=>{const t=new Map,n=[],s=[];let r=1;for(;;){const o=e.filter(a=>a.time===r);if(o.length===0)break;const i=new Set(o.filter(a=>a.state==="InProgress").map(a=>a.userStoryId));for(const a of i)t.has(a)||t.set(a,0);t.forEach((a,p)=>{t.set(p,a+1)});const c=new Set(o.filter(a=>a.state==="Done").map(a=>a.userStoryId));for(const a of c){const p=t.get(a);p&&n.push(p),t.delete(a)}const u=ee(n);s.push({time:r,leadTime:u}),r++}return s};class ne{constructor(t){l(this,"threads",[]);this.threads=t}getThreads(){return this.threads}}class se{constructor(t){l(this,"threads");this.threads=t}getThreads(){const t=this.threads.map(s=>s.power).reduce((s,r)=>s+r,0);return[{id:0,name:"mob",power:Math.round(t/this.threads.length)}]}}const d=e=>{var n;const t=Number.parseInt(((n=document.querySelector(e))==null?void 0:n.value)??"1");return Number.isNaN(t)?0:t},re=()=>{const e=d("#user-story-count-input"),t=d("#reviewers-input");return new E(Array.from({length:e},(n,s)=>({id:s,name:`US${s}`,complexity:d(`#complexity-input-${s}`),review:{reviewersNeeded:t,reviewers:new Map},reviewComplexity:d(`#review-complexity-input-${s}`),state:"Todo",threadId:void 0,progression:0})))},oe=()=>{const e=d("#user-story-count-input");return new E(Array.from({length:e},(t,n)=>({id:n,name:`US${n}`,complexity:d(`#complexity-input-${n}`),review:g,reviewComplexity:d(`#review-complexity-input-${n}`),state:"Todo",threadId:void 0,progression:0})))},ie=()=>{const e=d("#dev-count-input"),t=Array.from({length:e},(n,s)=>({id:s,name:`thread${s}`,power:d(`#power-input-${s}`)}));return new ne(t)},ce=()=>{const e=d("#dev-count-input"),t=Array.from({length:e},(n,s)=>({id:s,name:`thread${s}`,power:d(`#power-input-${s}`)}));return new se(t)},S=(e,t)=>{const n=new Array(y(e).length*10).fill(0).map(c=>Math.random()),{timeEvents:s,structureEvents:r}=k(e,t,n),o=crypto.randomUUID();C(s,o),b(r,o);const i=te(s);return $(i,o),o};document.addEventListener("DOMContentLoaded",()=>{var e,t,n;(e=document.querySelector("#calculate-button"))==null||e.addEventListener("click",()=>{const s=oe(),r=S(s,ce());window.open(`/TeamSpirit/flow/flow.html?id=${r}`),window.open(`/TeamSpirit/time-sequence/time-sequence.html?id=${r}`);const o=re(),i=S(o,ie());window.open(`/TeamSpirit/flow/flow.html?id=${i}`),window.open(`/TeamSpirit/time-sequence/time-sequence.html?id=${i}`)}),(t=document.querySelector("#generate-devs-button"))==null||t.addEventListener("click",()=>{const s=document.getElementById("devs-container"),r=d("#dev-count-input"),o=Array.from({length:r},(i,c)=>D(c));s==null||s.replaceChildren(...o)}),(n=document.querySelector("#generate-user-stories-button"))==null||n.addEventListener("click",()=>{const s=document.getElementById("user-stories-container"),r=d("#user-story-count-input"),o=Array.from({length:r},(i,c)=>U(c));s==null||s.replaceChildren(...o)})});
