import{S as l,m as v,n as C}from"./session-storage-Bvod-aZa.js";const q=()=>document.querySelector("#threads"),y=e=>document.querySelector(`#thread${e}`),g=()=>document.querySelector("#backlog"),w=()=>document.querySelector("#done"),i=e=>document.querySelector(`#${e}`),E=e=>Array.from(document.querySelectorAll(`[id^="${e}_"]`)),x=()=>document.querySelector("#compute"),$=()=>document.querySelector("#compute-all"),S=e=>{const t=document.createElement("div");return t.id=e,t.className="userStory",t.textContent=e,t},R=(e,t)=>{Array.from(new Set(t.map(r=>r.userStoryName))).filter(r=>r!=="idle").map(r=>S(r)).forEach(r=>{e.appendChild(r)})},k=e=>{const t=document.createElement("div");return t.id=`thread${e}`,t.className="thread",t.textContent=`thread ${e}`,t},A=(e,t)=>{Array.from(new Set(t.map(a=>a.thread))).forEach(a=>{const r=k(a);e.append(r)})},I=()=>document.querySelector("#lead-time"),b=()=>document.querySelector("#time"),D=e=>{const t=new Set,a=new Set;return e.filter(r=>r.state==l.REVIEW).forEach(r=>{t.has(r.userStoryName)?a.add(r.userStoryName):t.add(r.userStoryName)}),Array.from(a)},p=async(e,t,a)=>{var n,c,d,u,f,h;const r=e.filter(o=>o.time==t),m=D(r);for(const o of r)if(o.userStoryName!="idle"){if(o.state==l.IN_PROGRESS){const s=i(o.userStoryName);s&&((n=y(o.thread))==null||n.appendChild(s))}if(o.state==l.REVIEW)if(m.indexOf(o.userStoryName)!=-1){(c=i(o.userStoryName))==null||c.remove();const s=`${o.userStoryName}_${o.thread}`;(d=y(o.thread))==null||d.appendChild(i(s)??S(s))}else E(o.userStoryName).forEach(s=>s.remove()),(u=y(o.thread))==null||u.appendChild(i(o.userStoryName)??S(o.userStoryName));if(o.state==l.TO_REVIEW){const s=i(o.userStoryName);s&&((f=g())==null||f.appendChild(s))}if(o.state==l.DONE){E(o.userStoryName).forEach(T=>T.remove());const s=i(o.userStoryName)??S(o.userStoryName);(h=w())==null||h.appendChild(s)}await U(a)}},N=(e,t)=>{var n;const a=e.filter(c=>c.time==t);if(a.length==0)return;const r=I();r&&(r.textContent=((n=a[0].leadTime)==null?void 0:n.toFixed(2))??NaN);const m=b();m&&(m.textContent=a[0].time.toString())},O=(e,t)=>{const a=q();a&&A(a,e);const r=g();r&&R(r,e);const m=Math.max(...e.map(u=>u.time));let n=0;const c=x();c==null||c.addEventListener("click",async()=>{c.disabled=!0,n++,await p(e,n,1e3),N(t,n),m!==n&&c&&(c.disabled=!1)});const d=$();d==null||d.addEventListener("click",async()=>{for(;m!==n;)n++,await p(e,n,300),N(t,n);d&&(d.disabled=!0)})},U=e=>new Promise(t=>setTimeout(t,e)),_=v(),H=C();O(_,H);
